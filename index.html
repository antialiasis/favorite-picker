<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0">
    <title>Favorite Disney Song Picker</title>
    <link href="main.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/png"
        href="https://raw.githubusercontent.com/draav/favorite-disney-song-picker/master/favicon.png" />
    <script src="https://www.datadoghq-browser-agent.com/datadog-rum-v3.js" type="text/javascript">
    </script>
    <script>
        window.DD_RUM && window.DD_RUM.init({
            applicationId: '74904848-da50-41ef-8032-401c8b5f2e50',
            clientToken: 'pub29ddc6353b9d6fec7918decb0ec906a8',
            site: 'datadoghq.com',
            service: 'favorite-disney-song-picker',
            env: 'prod',
            // Specify a version number to identify the deployed version of your application in Datadog 
            // version: '1.0.0',
            sampleRate: 100,
            trackInteractions: true
        });
    </script>
</head>

<body>
    <h1>Favorite Disney Song Picker</h1>

    <p>For each group of songs presented to you, click one or more of your favorites from that group and press the
        "Pick" button. Eventually, your favorite songs will start appearing under "Found Favorites". You can continue as
        long as you like.</p>

    <div id="container">

        <div id="picking">
            <ul id="evaluating" class="item-list"></ul>

            <p id="buttons">
                <button id="pick">Pick</button>
                <button id="pass">Pass</button>
                <button id="undo">Undo</button>
                <button id="redo">Redo</button>
                <button id="reset">Reset</button>
            </p>

            <div class="picker-info">
                <p>Songs remaining to be eliminated before next favorite is found: <span id="remaining"></span></p>

                <p>Progress towards next favorite: <span id="progress-bar"><span></span></span></p>
            </div>
        </div>



        <div id="secondary">
            <h2>Found favorites</h2>

            <ol id="favorites" class="item-list"></ol>

            <p><a href="" id="shortcode-link">Permalink to this list</a></p>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="picker.js"></script>
    <script src="items.js"></script>
    <script src="picker-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.7.0/Sortable.min.js"></script>

    <div id="shared-list-modal" style="display:none">
        <button class="close shared-list-skip">&times;</button>
        <h2>Shared list</h2>

        <p>Generated by this picker tool. Create your own list or continue from this one below!</p>

        <ol id="shared-list" class="item-list"></ol>

        <p class="buttons">
            <button id="shared-list-continue">Continue from this list</button>
            <button class="shared-list-skip">Make my own list</button>
        </p>
    </div>
    <script>
        'use strict';

        var myPicker = new picker.Picker({
            items: items,
            localStorageKey: 'picker-state',
            shortcodeLength: 3,
        });

        var pickerUI = new PickerUI(myPicker, {
            elements: {
                pick: "#pick",
                pass: "#pass",
                undo: "#undo",
                redo: "#redo",
                reset: "#reset",
                evaluating: "#evaluating",
                favorites: "#favorites",
                shortcodeLink: "#shortcode-link",
                sharedListContainer: "#shared-list-modal",
                sharedList: "#shared-list",
                sharedListContinue: "#shared-list-continue",
                sharedListSkip: ".shared-list-skip"
            },
            onUpdate: function (updateType) {
                var total = this.picker.state.items.length;
                var favorites = this.picker.state.arrays.favorites.length;
                var eliminated = this.picker.state.arrays.eliminated.length;
                var remaining = Math.max(0, total - favorites - eliminated - 1);

                $("#remaining").text(remaining);

                updateProgressBar((1 - (remaining / this.picker.state.roundSize)) * 100, updateType);
            }
        });

        pickerUI.initialize();

        /* PROGRESS BAR */

        function updateProgressBar(value, updateType) {
            var $progressBar = $("#progress-bar span");

            if (['pick', 'undo', 'redo'].indexOf(updateType) !== -1) {
                if (!value && updateType !== 'undo') {
                    $progressBar.animate({ width: '100%' }, 400, function () {
                        $progressBar.width(0);
                    });
                } else {
                    if (!$progressBar.width() && updateType === 'undo') {
                        $progressBar.width("100%")
                    }
                    $progressBar.animate({ width: value + '%' }, 400);
                }
            } else {
                $progressBar.width(value + '%');
            }
        }
    </script>
</body>

</html>